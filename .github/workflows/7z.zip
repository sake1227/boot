name: payload提取


on:
  workflow_dispatch:
    inputs:
      rom_url:
        description: 'ROM 下载直链'
        required: true
        default: ''
      rom_name:
        description: '保存名称'
        required: true
        default: ''
jobs:
  TIQU:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@main

      - name: 安装依赖
        run: |
         sudo apt-get update
         sudo apt-get -y install python3-pip
         sudo apt install aria2
         sudo apt-get install p7zip
         
      - name: 同步上传
        run: |
         curl https://rclone.org/install.sh | sudo bash
         mkdir -p ~/.config/rclone/
         unzip -o rclone.zip -d ~/.config/rclone/
         
      - name: 提取镜像
        run: |
         mkdir -p ${GITHUB_WORKSPACE}/workspace && cd ${GITHUB_WORKSPACE}/workspace
         pip install git+https://github.com/5ec1cff/payload-dumper
         aria2c -s 10 -x 10 -d . -o firmware.7z "${{ github.event.inputs.rom_url }}"
         payload_dumper --partitions boot,vbmeta,init_boot firmware.7z
         cd ${GITHUB_WORKSPACE}/workspace/output
         7z a "${{ github.event.inputs.rom_name }}.7z" -p"beijian" *
         7z a "${{ github.event.inputs.rom_name }}.7z" /home/runner/work/boot/boot/获取解压密码.txt
         rclone sync "${{ github.event.inputs.rom_name }}.7z" 123:/boot大全
     
